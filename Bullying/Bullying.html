import React, { useState } from 'react';
import { Info, Users, Clock, Shield, Scale, ChevronRight, HelpCircle } from 'lucide-react';

const App = () => {
  const [activeStep, setActiveStep] = useState(null);
  const [activeRole, setActiveRole] = useState('all'); // all, parent, teacher, admin

  const steps = [
    {
      id: 'receive',
      title: '1. 接獲檢舉與通報',
      section: '受理階段',
      legal: '§17, §18',
      desc: '校長、職員、教師知悉疑似霸凌事件，需立即啟動。',
      adminNote: '24 小時內完成校安通報及社政通報。',
      teacherNote: '知悉後應立即向學校權責人員報告。',
      parentNote: '可向學校、教育局或部長信箱提出檢舉。',
      color: 'bg-blue-50',
      borderColor: 'border-blue-500',
      icon: <Info className="w-5 h-5 text-blue-600" />
    },
    {
      id: 'jurisdiction',
      title: '2. 確認調查權責',
      section: '受理階段',
      legal: '§18, §20',
      desc: '確認案件是否屬於本校管轄權責。',
      adminNote: '若非本校管轄，3 個工作日內移送調查學校。',
      color: 'bg-blue-50',
      borderColor: 'border-blue-500',
      icon: <Scale className="w-5 h-5 text-blue-600" />
    },
    {
      id: 'review',
      title: '3. 審查小組會議',
      section: '受理階段',
      legal: '§24, §25',
      desc: '決定是否受理案件。受理起 5 日內需組成處理小組。',
      adminNote: '接獲檢舉起 20 個工作日內需決議是否受理。',
      parentNote: '若不受理，檢舉人可於 20 日內提出陳情。',
      color: 'bg-blue-50',
      borderColor: 'border-blue-500',
      icon: <Users className="w-5 h-5 text-blue-600" />
    },
    {
      id: 'handling',
      title: '4. 組成處理小組',
      section: '調和/調查階段',
      legal: '§27, §29',
      desc: '召開會前會，選擇採行「調和」或「調查」程序。',
      teacherNote: '教師可能被邀請參與小組，需保持公正立場。',
      parentNote: '「調和」必須經雙方當事人同意始得進行。',
      color: 'bg-yellow-50',
      borderColor: 'border-yellow-500',
      icon: <Shield className="w-5 h-5 text-yellow-600" />
    },
    {
      id: 'pathway',
      title: '5. 調和或調查程序',
      section: '調和/調查階段',
      legal: '§29, §30, §32',
      desc: '執行具體訪談與事實釐清。',
      adminNote: '調查報告需於 2 個月內完成（可延長 2 次）。',
      teacherNote: '配合訪談並提供相關觀察輔導記錄。',
      parentNote: '調和中任一方可隨時終止調和，轉入調查。',
      color: 'bg-yellow-50',
      borderColor: 'border-yellow-500',
      icon: <Clock className="w-5 h-5 text-yellow-600" />
    },
    {
      id: 'committee',
      title: '6. 防制委員會審議',
      section: '審議階段',
      legal: '§34, §43, §46',
      desc: '審議報告並作成終局決議。',
      adminNote: '確認霸凌後，15 個工作日內作成終局處理。',
      parentNote: '雙方可對報告內容提出陳述意見。',
      color: 'bg-purple-50',
      borderColor: 'border-purple-500',
      icon: <Scale className="w-5 h-5 text-purple-600" />
    },
    {
      id: 'remedy',
      title: '7. 結果通知與救濟',
      section: '救濟程序',
      legal: '§46, §48, §49',
      desc: '書面通知處理結果與救濟管道。',
      adminNote: '10 個工作日內報主管機關備查。',
      parentNote: '若不服決議，可依規定啟動申訴或救濟程序。',
      color: 'bg-green-50',
      borderColor: 'border-green-500',
      icon: <ChevronRight className="w-5 h-5 text-green-600" />
    }
  ];

  const roles = [
    { id: 'all', label: '全部顯示', icon: <HelpCircle className="w-4 h-4" /> },
    { id: 'parent', label: '家長需知', icon: <Users className="w-4 h-4" /> },
    { id: 'teacher', label: '教師重點', icon: <Info className="w-4 h-4" /> },
    { id: 'admin', label: '行政/校方', icon: <Shield className="w-4 h-4" /> },
  ];

  const filteredNote = (step) => {
    if (activeRole === 'parent') return step.parentNote;
    if (activeRole === 'teacher') return step.teacherNote;
    if (activeRole === 'admin') return step.adminNote;
    return step.desc;
  };

  const isHighlighted = (step) => {
    if (activeRole === 'parent' && step.parentNote) return true;
    if (activeRole === 'teacher' && step.teacherNote) return true;
    if (activeRole === 'admin' && step.adminNote) return true;
    if (activeRole === 'all') return true;
    return false;
  };

  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-900">
      <div className="max-w-5xl mx-auto">
        {/* Header */}
        <div className="mb-8 text-center">
          <h1 className="text-3xl font-bold text-slate-800 mb-2">生對生校園霸凌事件處理流程圖</h1>
          <p className="text-slate-500">依據《校園霸凌防制準則》最新修訂製作</p>
          
          {/* Role Filter */}
          <div className="flex flex-wrap justify-center gap-2 mt-6">
            {roles.map((role) => (
              <button
                key={role.id}
                onClick={() => setActiveRole(role.id)}
                className={`flex items-center gap-2 px-4 py-2 rounded-full border transition-all ${
                  activeRole === role.id 
                  ? 'bg-blue-600 text-white border-blue-600 shadow-md' 
                  : 'bg-white text-slate-600 border-slate-200 hover:border-blue-300'
                }`}
              >
                {role.icon}
                {role.label}
              </button>
            ))}
          </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Main Flow SVG/List */}
          <div className="lg:col-span-2 space-y-4">
            {steps.map((step, index) => (
              <div key={step.id} className="relative">
                {/* Connecting Line */}
                {index !== steps.length - 1 && (
                  <div className="absolute left-6 top-12 w-0.5 h-12 bg-slate-200 z-0"></div>
                )}
                
                <div 
                  onClick={() => setActiveStep(step)}
                  className={`relative z-10 flex items-start gap-4 p-4 rounded-xl border-2 cursor-pointer transition-all ${
                    activeStep?.id === step.id ? 'shadow-lg scale-[1.02]' : 'hover:shadow-md'
                  } ${isHighlighted(step) ? `${step.borderColor} ${step.color}` : 'border-slate-100 bg-white opacity-60'}`}
                >
                  <div className={`mt-1 p-2 rounded-lg bg-white shadow-sm border ${step.borderColor}`}>
                    {step.icon}
                  </div>
                  <div className="flex-1">
                    <div className="flex justify-between items-start">
                      <span className="text-xs font-bold text-slate-400 uppercase tracking-wider">{step.section}</span>
                      <span className="text-xs font-mono bg-slate-200 px-2 py-1 rounded text-slate-600">{step.legal}</span>
                    </div>
                    <h3 className="text-lg font-bold mt-1">{step.title}</h3>
                    <p className="text-sm text-slate-600 mt-2 line-clamp-2">
                      {filteredNote(step) || step.desc}
                    </p>
                  </div>
                  <ChevronRight className={`w-5 h-5 mt-8 transition-transform ${activeStep?.id === step.id ? 'rotate-90' : ''}`} />
                </div>
              </div>
            ))}
          </div>

          {/* Detailed Info Panel */}
          <div className="lg:col-span-1">
            <div className="sticky top-8 bg-white rounded-2xl border border-slate-200 shadow-xl overflow-hidden">
              <div className="bg-slate-800 p-4 text-white">
                <h2 className="text-xl font-bold">詳細說明區</h2>
                <p className="text-slate-400 text-sm">點擊流程節點查看角色任務</p>
              </div>
              
              <div className="p-6 space-y-6">
                {activeStep ? (
                  <>
                    <div>
                      <h3 className="text-blue-600 font-bold mb-2 flex items-center gap-2">
                        <Info className="w-4 h-4" /> 階段概述
                      </h3>
                      <p className="text-slate-700 leading-relaxed">{activeStep.desc}</p>
                    </div>

                    <div className="space-y-4">
                      {activeStep.adminNote && (
                        <div className={`p-4 rounded-lg border-l-4 border-slate-700 bg-slate-50 ${activeRole === 'admin' ? 'ring-2 ring-slate-800' : ''}`}>
                          <div className="flex items-center gap-2 font-bold mb-1"><Shield className="w-4 h-4"/> 行政/學校</div>
                          <p className="text-sm text-slate-600">{activeStep.adminNote}</p>
                        </div>
                      )}
                      
                      {activeStep.teacherNote && (
                        <div className={`p-4 rounded-lg border-l-4 border-blue-500 bg-blue-50 ${activeRole === 'teacher' ? 'ring-2 ring-blue-600' : ''}`}>
                          <div className="flex items-center gap-2 font-bold mb-1 text-blue-700"><Info className="w-4 h-4"/> 教師/導師</div>
                          <p className="text-sm text-slate-600">{activeStep.teacherNote}</p>
                        </div>
                      )}

                      {activeStep.parentNote && (
                        <div className={`p-4 rounded-lg border-l-4 border-orange-500 bg-orange-50 ${activeRole === 'parent' ? 'ring-2 ring-orange-600' : ''}`}>
                          <div className="flex items-center gap-2 font-bold mb-1 text-orange-700"><Users className="w-4 h-4"/> 家長/學生</div>
                          <p className="text-sm text-slate-600">{activeStep.parentNote}</p>
                        </div>
                      )}
                    </div>

                    <div className="pt-4 border-t border-slate-100">
                      <div className="text-xs text-slate-400 italic text-center">
                        法源依據：校園霸凌防制準則 {activeStep.legal}
                      </div>
                    </div>
                  </>
                ) : (
                  <div className="flex flex-col items-center justify-center py-12 text-slate-400 text-center">
                    <HelpCircle className="w-12 h-12 mb-4 opacity-20" />
                    <p>請點擊左側流程節點<br/>查看各角色的權責與期限</p>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>

        {/* Footer Info */}
        <div className="mt-12 p-6 bg-slate-800 rounded-2xl text-white">
          <h3 className="font-bold mb-4 flex items-center gap-2">
            <Clock className="w-5 h-5 text-yellow-400" /> 重要處理時限總覽
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
            <div className="bg-slate-700 p-4 rounded-xl">
              <div className="text-yellow-400 font-bold mb-1">受理階段</div>
              接獲檢舉後 <span className="underline">20 個工作日</span> 內決議是否受理。
            </div>
            <div className="bg-slate-700 p-4 rounded-xl">
              <div className="text-yellow-400 font-bold mb-1">調查階段</div>
              召開第 1 次會議後 <span className="underline">2 個月</span> 內完成報告。
            </div>
            <div className="bg-slate-700 p-4 rounded-xl">
              <div className="text-yellow-400 font-bold mb-1">審議階段</div>
              終局決議後 <span className="underline">15 個工作日</span> 內作成處理決定。
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default App;